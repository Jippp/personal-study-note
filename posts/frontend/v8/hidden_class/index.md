---
date: 2024-09-23
title: V8之隐藏类和内联缓存
category: V8
tags:
- frontend
- 浏览器
- V8
description: V8中隐藏类、内联缓存的相关介绍
---
## 隐藏类和内联缓存

### 隐藏类

JS是动态语言，在运行的过程中可能会修改对象，比如:

```js
const o = {a: 1, b: 2}
function run() {
  o.c = 3
}
run()
```
在运行的过程中添加了一个`c`属性，修改了对象。

V8在后续的查找对象属性的过程，会按照`对象属性`来查找，很耗时，为了提升效率，就借鉴`静态语言`的特性，引入了`隐藏类`。

> 简单来说，隐藏类就是对对象形状的一种描述，后续查找会直接从隐藏类中找到对应属性。

`隐藏类`中记录了两个信息：

1. 对象中包含的所有属性
2. 属性相对于对象的内存偏移量

有了`隐藏类`，查找对象属性时，就会直接从`隐藏类`中找到属性相对于对象的`偏移量`，然后从内存中读取属性值。

有一些注意点：

- 多个相同的对象(声明的顺序、属性个数和名称都相同)会共用一个隐藏类
- 对象修改之后会重新创建隐藏类

### 内联缓存Inline Cache

如果多次重复读取对象属性，可以通过`内联缓存`来优化。

当`函数执行`时，会在读取对象属性和返回值时，将一些数据写入一个表格`(反馈向量)`中，`反馈向量`中缓存了一些临时数据包括偏移量、隐藏类等等。通过这个缓存就不用重复读取隐藏类，可以减少重复。

### 注意

需要注意的是，隐藏类和内联缓存对于效率提升比起其他的性能问题还是`微不足道`的，不需要过度关注这种`微优化`，只需要知道有这个内部的优化即可。