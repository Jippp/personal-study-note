---
date: 2024-09-23
title: V8之字节码
category: V8
tags:
- fontend
- 浏览器
- V8
description: V8中字节码的相关介绍
---
## V8中的字节码

V8中的字节码是作为一个中间代码过度的，在执行一段JS代码之前，需要编译为`字节码`，然后再解释执行字节码或将字节码编译成二进制代码执行。

早期的V8是直接将JS代码转为机器码执行，编译很耗时，但执行时很快，所以为了防止每次重新进入要重新编译，会将机器码缓存起来。但是机器码占用内存太多，移动端不友好，所以后面进行重构，引入了字节码。

即并不直接转成机器码，而是先转为字节码，编译速度减少，缓存也是缓存的字节码，虽然后面执行时间会增长，但这也是权衡利弊之后的结果。

执行JS代码的大致流程如下：首先会调用V8中的`解析器Parser`将JS代码转为`AST`并生成对应`作用域`，然后将`AST`给`解释器`处理；解释器中先转为`字节码`，然后解释执行，对于热点代码(会重复多次)会编译成`二进制存储`，可以加快执行效率。

从上面看出，引入字节码可以带来以下的好处：

- 编译成字节码比编译成机器码要更快，所以启动会更快；

- 字节码比机器码内存要小，所以内存占用更少；
- `字节码`是平台无关的，可以降低跨平台的难度。

虽然执行机器码比执行字节码要快，但是权衡利弊之后还是选择引入字节码。
